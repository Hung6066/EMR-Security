<!-- src/app/components/security/session-playback/session-playback.component.html -->
<div class="playback-container">
  <h1>Session Recording & Playback</h1>
  
  <div class="playback-layout">
    <!-- List of Recordings -->
    <mat-card class="session-list">
      <mat-card-header>
        <mat-card-title>Recorded Sessions</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <table mat-table [dataSource]="recordings" class="mat-elevation-z2">
          
          <ng-container matColumnDef="userName">
            <th mat-header-cell *matHeaderCellDef>User</th>
            <td mat-cell *matCellDef="let rec">{{ rec.userName || 'User #' + rec.userId }}</td>
          </ng-container>

          <ng-container matColumnDef="startedAt">
            <th mat-header-cell *matHeaderCellDef>Start Time</th>
            <td mat-cell *matCellDef="let rec">{{ rec.startedAt | date:'dd/MM/yy HH:mm' }}</td>
          </ng-container>

          <ng-container matColumnDef="duration">
            <th mat-header-cell *matHeaderCellDef>Duration</th>
            <td mat-cell *matCellDef="let rec">{{ getDuration(rec.startedAt, rec.endedAt) }}</td>
          </ng-container>

          <ng-container matColumnDef="size">
            <th mat-header-cell *matHeaderCellDef>Size</th>
            <td mat-cell *matCellDef="let rec">{{ formatSize(rec.sizeBytes) }}</td>
          </ng-container>
          
          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef>Actions</th>
            <td mat-cell *matCellDef="let rec">
              <button mat-icon-button (click)="playSession(rec)" matTooltip="Play">
                <mat-icon>play_circle</mat-icon>
              </button>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row 
              *matRowDef="let row; columns: displayedColumns;" 
              [class.selected-row]="selectedRecording?.id === row.id"></tr>
        </table>
      </mat-card-content>
    </mat-card>
    
    <!-- Player -->
    <mat-card class="player-container">
      <mat-card-header>
        <mat-card-title>Playback</mat-card-title>
        <mat-card-subtitle *ngIf="selectedRecording">
          Session #{{ selectedRecording.id }} - {{ selectedRecording.userName }}
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div *ngIf="loading" class="loading-player">
          <mat-spinner></mat-spinner>
          <p>Loading session...</p>
        </div>
        
        <div #playerTarget class="rr-player"></div>

        <div *ngIf="!selectedRecording && !loading" class="no-selection">
          <mat-icon>slideshow</mat-icon>
          <p>Select a session to play</p>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>